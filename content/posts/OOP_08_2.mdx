---
title: ì½”ë“œìŠ¤í”¼ì¸ 80_OOP design with game (1)- 2. OOAD & í”„ë¡œì‹œì € P
date: '2019-02-23'
description: >-
  > ì½”ë“œìŠ¤í”¼ì¸  ê°•ì˜ ì •ë¦¬ë¡ ìƒì†Œí•œ ë„ë©”ì¸ìœ¼ë¡œ ë°°ìš°ëŠ”ê²Œ ì¢‹ë‹¤.  ìµìˆ™í•œ ë„ë©”ì¸ë“¤ì€ ìµìˆ™í•œ ì²˜ë¦¬ë°©ë²•ìœ¼ë¡œ
  ì²˜ë¦¬í•˜ê¸°ë•Œë¬¸ì— ê°ì²´ì§€í–¥ì„ ë°°ìš°ê¸° ì–´ë µë‹¤.  ë•Œë¬¸ì— 80ê¸°ëŠ” ê²Œì„ì„ í†µí•´ì„œ ì§„í–‰í•  ì˜ˆì •. --- ê°ì²´ì§€í–¥
  í”„ë¡œê·¸ë˜ë°ì„ ë°°ìš°ê¸° ì „, í”„ë¡œì‹œì € í”„ë¡œê·¸ë˜ë° í˜•íƒœì˜ ì½”ë“œë¥¼ ì•Œì•„ë³¸...
author: Joy Kim
tags:
  - javaScript
  - OOP
categories:
  - 01_Web
  - zz. Workshop
enableComment: true
thumbnail: /images/2019/12/thumb_default.jpg
---

> ì½”ë“œìŠ¤í”¼ì¸  ê°•ì˜ ì •ë¦¬ë¡

ìƒì†Œí•œ ë„ë©”ì¸ìœ¼ë¡œ ë°°ìš°ëŠ”ê²Œ ì¢‹ë‹¤. ìµìˆ™í•œ ë„ë©”ì¸ë“¤ì€ ìµìˆ™í•œ ì²˜ë¦¬ë°©ë²•ìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸°ë•Œë¬¸ì— ê°ì²´ì§€í–¥ì„
ë°°ìš°ê¸° ì–´ë µë‹¤. ë•Œë¬¸ì— 80ê¸°ëŠ” ê²Œì„ì„ í†µí•´ì„œ ì§„í–‰í•  ì˜ˆì •.

---

ê°ì²´ì§€í–¥ í”„ë¡œê·¸ë˜ë°ì„ ë°°ìš°ê¸° ì „, **í”„ë¡œì‹œì € í”„ë¡œê·¸ë˜ë°** í˜•íƒœì˜ ì½”ë“œë¥¼ ì•Œì•„ë³¸ë‹¤.


# 2. ê²Œì„ ê°œìš” ë° ê·œì¹™
<img src="/images/2019/12/01.png" />


## 2.1 ì•¤í‹°í‹° íŒŒì•…
ì•„í‚¤í…íŠ¸ë‚˜ ë””ìì¸íŒ¨í„´ì„ ë§Œë“œëŠ” ì„¤ê³„ìë“¤ì€ 
í˜„ìƒì„ ë³´ê³ , í˜„ìƒìœ¼ë¡œë¶€í„° í”„ë¡œê·¸ë¨ ì—”í‹°í‹°ë¥¼ ë„ì¶œí•´ì„œ ì„¤ê³„ë¥¼ ë“¤ì–´ê°„ë‹¤.
- ë¸”ëŸ­ì—ëŠ” íƒ€ì…ì´ ìˆêµ¬ë‚˜.
- ë¸”ëŸ­ connectì˜ ìµœì € ê°¯ìˆ˜ ì œí•œì´ ìˆê² êµ¬ë‚˜.
- ìŠ¤í…Œì´ì§€ì˜ ê°€ë¡œ ì„¸ë¡œ ê°¯ìˆ˜
- ì„ íƒí–ˆë˜ ë¸”ëŸ­ë“¤ì„ ëŒì•„ê°ˆ ìˆ˜ ìˆë‹¤.
- ìƒˆë¡œìš´ ë¸”ë¡ì´ ë–¨ì–´ì§„ë‹¤.
  
  > ì¸ì§€ê³¼í•™
    ê°€ìƒì„¸ê³„ì„ì—ë„ ë¶ˆêµ¬í•˜ê³  ë¬¼ë¦¬ë ¥ê°€ ì¤‘ë ¥ì„ ê¸°ëŒ€í•œë‹¤ ã…‹


## 2.2 ê·œì¹™


### Entity - ë¸”ëŸ­íƒ€ì…: 5ê°€ì§€ (0,1,2,3,4) - cell size: 8*8

### Core Action

<img src="/images/2019/12/02.png" />

1. í•œë²ˆì— 3ê°œ ì´ìƒ ê°™ì€ ìƒ‰ìœ¼ë¡œ ì¸ì ‘í•œ ë¸”ë¡ì´ ì„ íƒë˜ë©´
2. ì‚­ì œë¨
3. ì‚­ì œë˜ë©´ ìœ„ì˜ ë¸”ë¡ì´ ë‚´ë ¤ì˜´.
4. ë‚´ë ¤ì˜¨ ë’¤
5. ê³µê°„ì˜ ë¸”ë¡ì´ ìƒì„±ë˜ì–´ ì±„ì›Œì§

> cf\_\_1 **ê²Œì„ì´ì•¼ê¸°** ~ ëª¨ë°”ì¼ì‹œëŒ€ì—ì„œëŠ” ë³µì¡í•œ core actionì´ ë§ì´ ë“¤ì–´ê°„ ê²Œì„ì€ ìƒí’ˆì„±ì´ ì—†ë‹¤.
> (ì•ˆì¢‹ì€ ì˜ˆ: ì™€ìš°) core actionì´ ë‹¨ìˆœí•œ ê²Œì„ì´ ìƒí’ˆì„±ì´ ì¢‹ë‹¤. ìµœê·¼ rpgê²Œì„ë“¤ì€ ë‹¨ìˆœí•˜ê²Œ ë³€í–ˆë‹¤.
> í•œë¶“ê·¸ë¦¬ê¸°ë„ ì´ë¯¸ ì˜¤ë˜ì „ì— ëˆ„ê°€ ì°¾ì•„ë‚¸ ì½”ì–´ì•¡ì…˜ì¤‘ì— í•˜ë‚˜ì´ë‹¤. ì¬ë°ŒëŠ” ë°˜ë³µê±°ë¦¬ë¥¼ ì°¾ì•„ë‚´ë©´
> ë²—ì–´ë‚˜ë ¤ê³  í•˜ì§€ ì•ŠëŠ”ë‹¤.

---

---

# 3. ì–´ë””ì„œë¶€í„° ì‹œì‘í• ê¹Œ? ## í”„ë¡œê·¸ë¨ì˜ í•µì‹¬ì€ ë°ì´í„° ì‚¬ëŒì€ í‘œë©´ì ì¸ ê²ƒë§Œ
íŒŒì•…í•˜ë ¤ê³  í•œë‹¤. - í‘œë©´ì ì¸ ê²ƒê³¼ ì‹œê°ì ì¸ ê²ƒ - ê²½í—˜ì— ì˜ì¡´ì— ì˜í•´ì„œ íŒŒì•…í•˜ê¸° ë•Œë¬¸ì— ê²½í—˜í•œ ê²ƒë§Œ
ë³´ì¸ë‹¤.

í”„ë¡œê·¸ë¨ì˜ í•µì‹¬ì€ ë°ì´í„°ì´ë‹¤.

- ê±°ì˜ ëŒ€ë¶€ë¶„ì˜ í”„ë¡œê·¸ë¨ë“¤ì€ ë‹¤ ì˜ˆìœ ë°ì´í„° view.
- ê°œë°œìì˜ ëˆˆìœ¼ë¡œ ë³´ë©´ í”„ë¡œê·¸ë¨ì˜ í•µì‹¬ì€ ë°ì´í„°ì´ë‹¤.

## entityì˜ ì¢…ë¥˜ë¥¼ ë¯¸ë¦¬ íŒŒì•…í•˜ì. ğŸ‘€

```js
column = 8;
row = 8;
blockTypes = [0, 1, 2, 3, 4];
Block = class {
  constructor() {}
  isNext() {}
  isValid() {}
};
```

### í˜„ì‹¤ì„¸ê³„ entityì—ëŠ” ì´ 3ê°€ì§€ ì´ì™¸ì—ëŠ” ë°œê²¬í•˜ê¸° í˜ë“¤ë‹¤.

1. ìŠ¤ì¹¼ë¼ ê°’

- ì„¤ì •ì— ë”°ë¼ ììœ ë¡­ê²Œ í¬ê¸°ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŒ.
- ë‹¨ì¼ ê°’
- ê°€ë³€ì 
- (í•œë²ˆì— í•˜ë‚˜ì˜ ê°’ë§Œ ë³´ìœ í•  ìˆ˜ ìˆëŠ” ì›ìëŸ‰
  [from wiki](https://ko.wikipedia.org/wiki/%EC%8A%A4%EC%B9%BC%EB%9D%BC))

2. ì •ì˜ê°’

- ë¯¸ë¦¬ ì •í•´ì§„ íƒ€ì…ì´ ì¡´ì¬í•œë‹¤.
- bolckTypesëŠ” ì½œë ‰ì…˜ ê°œë…ì´ ì•„ë‹ˆë‹¤. ì§‘í•©ì„ ì •ì˜í•œ ê°œë…ì´ë‹¤. í•˜ë‚˜ì˜ ê°’ì¸ê²ƒì²˜ëŸ¼.

3. ê°ì²´ê°’

- ìƒì„±ë˜ê±°ë‚˜ ì‚­ì œë˜ê³ , ì—°ê²°ë˜ê±°ë‚˜ ì¡°ê±´ì„ íŒŒì•…í•œë‹¤.
- ë¸”ë¡ì„ ê°ì²´ë¡œ ë³´ëŠ” ì´ìœ ëŠ” **ë¸”ë¡ì´ ìì‹ ë§Œì˜ ì±…ì„ì„ ìœ„ì„í•  ìˆ˜ ìˆê¸° ë•Œë¬¸**ì´ë‹¤.
  - ë‹¤ìŒë²ˆì— ì˜¬ ìˆ˜ ìˆëŠ” ë¸”ë¡ì´ë‹ˆ?
  - ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì¸ ìƒíƒœì´ë‹ˆ?
  - ìì‹ ì˜ ìƒíƒœë¥¼ ì€ë‹‰í•˜ê³  ìº¡ìŠí™”
- ë¸”ë¡ì—ëŠ” ìì‹ ë§Œì˜ ì±…ì„ì„ ê°€ì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ê°ì²´ë¡œ í‰ê°€í•˜ê²Œ ëœë‹¤.

> UMLì„ ê¹Šì´ ê³µë¶€í•˜ë©´ 5ê°€ì§€ ì¢…ë¥˜ì˜ ì—¬ëŸ¬ê°€ì§€ entityê³¼ ê´€ê³„ê°€ ë‚˜ì˜¨ë‹¤.

---

### cf\_\_2. í´ë˜ìŠ¤ì´ëƒ? ì‹±ê¸€í†¤ ê°ì²´ì´ëƒ?ë¥¼ í•­ìƒ ê³ ë¯¼í•œë‹¤.

> ì‹±ê¸€í†¤ ê°ì²´ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹œì‘ë  ë•Œ ì–´ë–¤ í´ë˜ìŠ¤ê°€ ìµœì´ˆ í•œë²ˆë§Œ ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ê³ (Static) ê·¸
> ë©”ëª¨ë¦¬ì— ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©í•˜ëŠ” ë””ìì¸íŒ¨í„´. ìƒì„±ìê°€ ì—¬ëŸ¬ ì°¨ë¡€ í˜¸ì¶œë˜ë”ë¼ë„ ì‹¤ì œë¡œ ìƒì„±ë˜ëŠ”
> ê°ì²´ëŠ” í•˜ë‚˜ê³  ìµœì´ˆ ìƒì„± ì´í›„ì— í˜¸ì¶œëœ ìƒì„±ìëŠ” ìµœì´ˆì— ìƒì„±í•œ ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤. ì‹±ê¸€í†¤ íŒ¨í„´ì€ ë‹¨
> í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•´ ì‚¬ìš©í•˜ëŠ” ë””ìì¸ íŒ¨í„´ì´ë‹¤.

- ê°ì²´ëŠ” í•˜ë‚˜ë§Œ ìˆê±°ë‚˜ ì—¬ëŸ¬ê°œ ìˆë‹¤. í•˜ë‚˜ë§Œ ìˆëŠ” ê²ƒì¸ì§€ ì—¬ëŸ¬ê°œ ìˆëŠ” ê²ƒì¸ì§€ íŒŒì•…í•´ì•¼í•œë‹¤.
- í•˜ë‚˜ë§Œ ìˆëŠ”ë° í´ë˜ìŠ¤ë¡œ ì •ì˜í•˜ê±°ë‚˜ ì—¬ëŸ¬ê°œ ìˆëŠ” ê²ƒì¸ë° ê°ì²´ë¡œ ë§Œë“¤ë©´ ë°˜ë“œì‹œ ê³ ìš°íˆ¬í—¬..
  - ì—¬ëŸ¬ê°œ ìˆëŠ” ê²ƒì„ ê°œë³„ì ìœ¼ë¡œ ë§Œë“¤ë©´, ì—¬ëŸ¬ê°œ ìˆëŠ” ì• ë“¤ì€ ë³´í†µ ë³€í™”ë¥¼ í•œêº¼ë²ˆì— ì¼ìœ¼ì¼œì•¼í•˜ëŠ”ë°
    ê°œë³„ì ìœ¼ë¡œ ë§Œë“¤ì—ˆê¸° ë•Œë¬¸ì— í•œêº¼ë²ˆì— ìˆ˜ì •í•  ìˆ˜ ì—†ê²Œ ëœë‹¤.
  - í•˜ë‚˜ë§Œ ìˆì–´ì•¼ í•˜ëŠ”ë° í´ë˜ìŠ¤ë¡œ ë§Œë“¤ë©´ ì¸ìŠ¤í„´ìŠ¤ê°€ ì—¬ëŸ¬ê°œ ìƒê¸¸ ìˆ˜ ìˆë‹¤.

---

---


## 3.1 [ê°ì²´] Block 1. í´ë˜ìŠ¤? í˜¹ì€ ì‹±ê¸€í†¤ ê°ì²´? - ë¸”ë¡ì€ ì—¬ëŸ¬ê°œ ìƒì„±ë˜ë¯€ë¡œ **í´ë˜ìŠ¤** 2. ì±…ì„

```js
const Block = class {
  constructor(type) {
    this._type = type;
  }
  get image() {
    return `url('img/${this._type}.png')`;
  }
  get type() {
    return this._type;
  }
};
Block.GET = (type = parseInt(Math.random() * 5)) => new Block(type);
```

1. ìì‹ ë§Œì˜ **íƒ€ì…**ì„ ê°–ëŠ”ë‹¤.

- `parseInt(Math.random()*5)`: 0 ~ 4 ì‚¬ì´ì˜ íƒ€ì…ì„ ì–»ê²Œë¨
- **ì¸ìì— ì´ˆê¸°í™” ì½”ë“œë¥¼ ëª…ì‹œí•´ì£¼ë©´ ì„ ì–¸ê³¼ ì½”ë“œì˜ ë‚´ìš©ì„ ë¶„ë¦¬í•  ìˆ˜ ìˆì–´ì„œ ê°€ë…ì„±ì´ ì¢‹ì•„ì§„ë‹¤.**

2. íƒ€ì…ì— ë”°ë¥¸ **ì´ë¯¸ì§€ ê²½ë¡œ**ë¥¼ ë°˜í™˜í•œë‹¤. (íƒ€ì…ì— ë”°ë¥¸ ë¸”ë¡ ì´ë¯¸ì§€ê°€ ë‹¤ë¥´ë‹ˆê¹Œ.. )

### ì™œ factory í•¨ìˆ˜ë¡œ? (`Block.GET`)

- Block í´ë˜ìŠ¤ëŠ” **ë°›ì•„ì˜¨ typeì„ ìê¸° íƒ€ì…ìœ¼ë¡œ ê¸°ì–µí•˜ëŠ”ë°**ë§Œ ê´€ì‹¬ ìˆë‹¤.
- íƒ€ì…ì„ ì „ë‹¬í•˜ì§€ ì•Šì•˜ì„ ë•Œ ì–´ë–»ê²Œ ë§Œë“œëŠ”ì§€ëŠ” **ì—„ë°€í•˜ê²Œ ë”°ì§€ë©´ ë¸”ëŸ­ì˜ ì§€ì‹ì€ ì•„ë‹ˆë‹¤.**
  - ë¸”ëŸ­ì„ ë§Œë“œëŠ” ìª½ì´ ê´€ì‹¬ ìˆë‹¤.
    - ë§Œë“œëŠ” ìª½ì´ ê´€ì‹¬ìˆëŠ” ê²ƒê³¼ ë§Œë“¤ì–´ ì§€ëŠ” ìª½ì´ ê´€ì‹¬ìˆëŠ” ê²ƒì´ ë‹¤ë¥´ë‹¤.
  - ëœë¤í•¨ìˆ˜ëŠ” íŒ©í† ë¦¬ í•¨ìˆ˜ê°€ ê°€ì ¸ì•¼í•  ì§€ì‹ì´ë‹¤.

### íŒ©í† ë¦¬ í•¨ìˆ˜ëŠ” í´ë˜ìŠ¤ ë‚´ë¶€ë¡œ ê°€ë©´ ì•ˆëœë‹¤.

- **ë³€í™”ìœ¨**ë•Œë¬¸ì—!
- íƒ€ì…ì€ stageë§ˆë‹¤ ë°”ë€”êº¼ê³ , ì•„ì´í…œ ì¶”ê°€ë˜ë©´ ë” ë°”ë€” ê²ƒì´ë‹¤.
- íƒ€ì…ì€ ë³€í™”ìœ¨ì´ ë†’ì€ ê°œë…ì´ë¯€ë¡œ í´ë˜ìŠ¤ì™€ ë¶„ë¦¬í•˜ì—¬ ëª…í™•í•œ ì˜ë„ë¥¼ ì‘ì„±í•˜ê²Œ í•œë‹¤.

> **ë³€í™”ìœ¨ì„ í‰ê°€í•˜ëŠ” ê°€ì¥ ì‰¬ìš´ ë°©ë²•** ë³€í™”ìœ¨ì„ ì˜ ë””ìì¸ í–ˆìœ¼ë©´ ì±…ì„ì´ ì—†ë‹¤ê³  ìƒê°ë¬ë˜ ê°ì²´ëŠ”
> ìˆ˜ì •ë˜ì§€ ì•Šì•„ì•¼í•œë‹¤. ìš°ë¦¬ì˜ ëª©í‘œëŠ” ë³´ë‹¤ ë” ë§ì€ íŒŒì¼ì„ ì•ˆê±´ë“œë¦¬ê³  **ì¼ë¶€íŒŒì¼ë§Œ ê±´ë“œë ¤ì•¼í•œë‹¤.**

---

#### cf\_\_3. Factory í•¨ìˆ˜

ê°ì²´ì§€í–¥í•  ë•Œ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ìƒì„±ìë¥¼ ë´‰ì¸í•˜ì. **factoryí•¨ìˆ˜ë¡œ í´ë˜ìŠ¤ë¥¼ ì–»ì–´ê°€ê²Œ í•˜ì.**

- `static` í‚¤ì›Œë“œ ì¨ì„œ ë¶ˆëŸ¬ì˜¤ê²Œ í•´ë„ë¨.
- factory í•¨ìˆ˜ì˜ ëª…ì¹­ì€ ì¼ê´€ë˜ê²Œ ëª¨ë“  í´ë˜ìŠ¤ì— ìƒì„±ìë¥¼ ëŒ€ì‹ í•˜ëŠ” ìŠ¤íƒœí‹± í•¨ìˆ˜ë¥¼ ë§Œë“¤ì. (ì˜ˆì œì—ì„œëŠ”
  `GET`)
  > íŒ©í† ë¦¬ í•¨ìˆ˜ : ê°ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜

---

#### cf\_\_4. **ë‹¨ì¼ ì±…ì„ì›ì¹™ í›ˆë ¨í•˜ê¸°**

ë‹¨ì¼ ì±…ì„ì›ì¹™ì€ ì—„ë°€í•˜ê²Œ ì§€í‚¤ë ¤ë©´ êµ‰ì¥íˆ ì–´ë µê³ , ì„¬ì„¸í•˜ê²Œ ë°”ë¼ë³´ëŠ” ëˆˆìœ¼ë¡œ ì–¸ì œë‚˜ ì˜ì‹¬í•´ì„œ ê´€ë¦¬í•˜ì§€
ì•Šìœ¼ë©´ ì‹¤ë ¥..í‚¤ì›Œì§€ì§€ ì•ŠëŠ”ë‹¤. (ë¹ ë¥´ë©´ 3ë…„ ëŠ¦ìœ¼ë©´ 5ë…„..ã…)

---


## 3.2 [ê°ì²´] Game ê²Œì„ì´ë¼ëŠ” ê°ì²´ëŠ” ë¸”ë¡ë“¤ì„ ì†Œìœ í•˜ëŠ” ë§ˆìŠ¤í„° ê°ì²´

1. í´ë˜ìŠ¤ì´ëƒ? ì‹±ê¸€í†¤ ê°ì²´ì´ëƒ? ê²Œì„ì€ í•˜ë‚˜ì˜ ê°ì²´ë§Œ ìˆìœ¼ë©´ ëœë‹¤. (ë°”ë‘‘íŒ í•˜ë‚˜.) êµ¬ì§€ í´ë˜ìŠ¤ë¡œ
   ì„ ì–¸í•˜ì§€ ì•Šê³ , ì‹±ê¸€í†¤ ê°ì²´ë¡œ ë§Œë“ ë‹¤. => ì‹±ê¸€í†¤ ê°ì²´
2. ì±…ì„ 2ë²ˆê³¼ 3ë²ˆì€ ë‚´ë¶€ì—ì„œë§Œ ì•Œë©´ëœë‹¤.
3. ì´ˆê¸°í™” í•„ìš”í•œ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê²Œì„ ë³¸ì²´ë¥¼ ìƒì„±
4. ë Œë”ë§ ê·¸ë¦¼ ê°±ì‹ 
5. ì´ë²¤íŠ¸ ê±¸ê¸° ê° ë¸”ë¡ì—ì„œ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬

6. ì™¸ë¶€ì—ì„œ ê²Œì„ì˜ ì–´ë–¤ ìƒíƒœë§Œ ì•Œë©´ ë ê¹Œ?

- ê²Œì„ ì´ˆê¸°í™” í•¨ìˆ˜ë§Œ í•˜ë‚˜ ë…¸ì¶œí•˜ë©´ ë¨

```js
// ê²Œì„ì€ ì´ˆê¸°í™”ëœ ê²Œì„ì´ ë°”ë¡œ ìƒì„±ë˜ì–´ì•¼ í•˜ë¯€ë¡œ, ì¦‰ì‹œì‹¤í–‰í•¨ìˆ˜ë¡œ.
const Game = (_ => {
  const init = ...
  ...
  return init;
})()
```

---

# 4. Game ì‹œë‚˜ë¦¬ì˜¤ 1. í…Œì´ë¸” í˜•íƒœ ì •ì˜ 2. í…Œì´ë¸” ìƒì„± 3. í…Œì´ë¸” ë‚´ì— ë¸”ë¡ ë°ì´í„°
ì±„ìš°ê¸° (data) 2ì°¨ì›ë°°ì—´ì„ ë§Œë“¤ì–´ì•¼í•˜ê¸°ë•Œë¬¸ì— rowì™€ columnì„ ëŒë©´ì„œ ìƒì„±í•œë‹¤. 4. ë Œë”ë§ - dataëŠ”
inMemory ê°ì²´ - renderë¥¼ ë”°ë¡œ í˜¸ì¶œí•˜ëŠ” ê²ƒì€ ë„¤ì´í‹°ë¸Œ ê°ì²´ì´ê¸°ë•Œë¬¸ì—(domì˜ ì„¸ìƒ..) 5. ë Œë”ë§ ì „
tableì— ì´ë²¤íŠ¸ ê±¸ê¸°.

---


### 1. + 2. + 3. [ê°ì²´, ìŠ¤ì¹¼ë¼ê°’, ì •ì˜ê°’] í…Œì´ë¸” ë°ì´í„° ì •ì˜ 1. í…Œì´ë¸” í˜•íƒœ ì •ì˜ 2. í…Œì´ë¸” ìƒì„± 3.
í…Œì´ë¸” ë‚´ì— ë¸”ë¡ ë°ì´í„° ì±„ìš°ê¸° (data)

```js
const Game = (_ => {
  const column = 8, row = 8, blockSize = 80;
  const data = [];
  let table;

  const init = tid => {
    table = document.querySelector(tid);
    for (let i = 0; i < row; i++){
      const r = [];
      data.push(r);
      for(let j = 0; j < column; j++) r[j] = Block.GET();
    }
    render();
  };

  const render = _ => {...}
})
```

---


### 4. ë Œë”ë§ ë°ì´í„°ë¥¼ ì†Œë¹„í•´ì„œ í‘œë¥¼ ë‹¤ì‹œ ê·¸ë ¤ì£¼ëŠ” ë¡œì§.

```js
const Game = (_ => {
  const column = 8, row = 8, blockSize = 80;
  const data = [];
  let table;
  const init = tid => {
    ...
    render();
  };
  ///
  ğŸ‘‡ğŸ‘‡ğŸ‘‡
  const el = tag => document.createElement(tag);
  const render = _ => {
    table.innerHTML = '';
    data.forEach(row => table.appendChild(
      row.reduce((tr, block) => {
        tr.appendChild(el('td')).style.cssText = `
          ${block? `background: ${block.image};` : ''}
          width: ${blockSize}px;
          height: ${blockSize}px
          cursor: pointer`;
        return tr;
      }, el('tr'))
    ));
  };
  ğŸ‘†ğŸ‘†ğŸ‘†
})
```

ë°°ì—´ì„ ë£¨í”„ëŒì•„ì„œ ê°ê°ì˜ ì¤„ì„ tdë¥¼ ê°–ëŠ” trë¡œ ë°”ê¿”ì„œ tableì— ë„£ê³  ì‹¶ìŒ.

- tdë¥¼ ê°–ëŠ” trë¡œ
  <img src="/images/2019/12/04.png" style={{width: '20rem'}} />
- ê°ê°ì˜ ì¤„ì„ (tdë¥¼ ê°–ëŠ”) trë¡œ ë°”ê¿”ì„œ
  <img src="/images/2019/12/03.png" style={{width: '20rem'}} />

---

##### cf\_\_5. ë°°ì—´ì˜ ê³ ì°¨í•¨ìˆ˜

ë°°ì—´ì˜ ê³ ì°¨í•¨ìˆ˜ë¥¼ ì“°ëŠ” ì›ë¦¬ëŠ” ê°„ë‹¨í•˜ë‹¤.

- ë£¨í”„ëŒê³  ì‹¶ìœ¼ë©´ `forEach`
- ë°°ì—´ì˜ ì›ì†Œë¥¼ ë°”ê¾¼ ë°°ì—´ì„ ì–»ê³  ì‹¶ìœ¼ë©´ `map`
- í•˜ë‚˜ì˜ ê°’ìœ¼ë¡œ ë­‰ì¹˜ê³  ì‹¶ìœ¼ë©´ `reduce`
  > ì—¬ëŸ¬ê°œì˜ ì§‘í•©ì„ í•˜ë‚˜ì˜ ìŠ¤ì¹¼ë¼ê°’ìœ¼ë¡œ ë°”ê¾¸ëŠ” ê²ƒ

---


### 5. tableì— ì´ë²¤íŠ¸ ê±¸ê¸°.

```js

const Game = (_ => {
  const column = 8, row = 8, blockSize = 80;
  const data = [];
  let table;
  const init = tid => {
    table = document.querySelector(tid);
    for (let i = 0; i < row; i++){
      const r = [];
      data.push(r);
      for(let j = 0; j < column; j++) r[j] = Block.GET();
    }
    ğŸ‘‡ğŸ‘‡ğŸ‘‡
    table.addEventListener('mousedown', down);
    table.addEventListener('mouseup', up);
    table.addEventListener('mouseleave', up);
    table.addEventListener('mousemove', move);
    ğŸ‘†ğŸ‘†ğŸ‘†
    render();
  };
  const el = tag => document.createElement(tag);
  const render = _ => {...}
})
```

- mousedown
  - ë§ˆìš°ìŠ¤ë¥¼ ëˆ„ë¥´ëŠ” ê·¸ ìˆœê°„. (clickê³¼ ë‹¤ë¥´ê²Œ pressí•˜ëŠ” ìˆœê°„)
- mouseup
  - ì†ê°€ë½ì„ ë–¼ëŠ” ê·¸ ìˆœê°„.
- mouseleave
  - ë°”ì¸ë”©ëœ ìš”ì†Œì—ë§Œ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©°, í•´ë‹¹ ì—˜ë¦¬ë¨¼íŠ¸ì˜ ì˜ì—­ì—ì„œ ë§ˆìš°ìŠ¤ê°€ ë²—ì–´ë‚  ë•Œ ë°œìƒí•œë‹¤.
- mousemove
  - ë§ˆìš°ìŠ¤ê°€ ì—˜ë¦¬ë¨¼íŠ¸ì—ì„œ ì›€ì§ì¼ ë•Œ

---


### 5.1 ì´ë²¤íŠ¸ > ë¸”ëŸ­ì„ ëˆ„ë¥´ëŠ” ìˆœê°„: down
1. moveëŠ” mousedownì¸ ìƒíƒœì—¬ì•¼ ì˜ë¯¸ê°€ ìˆë‹¤.
  **downì˜ ìƒíƒœê°’** í•„ìš”

2. í˜„ì¬ ëˆŒëŸ¬ì§„ ë¸”ë¡ì˜ ìœ„ì¹˜ê°’ ì•Œì•„ì•¼í•¨. eventë¡œë¶€í„° x,yê°’ ì „ì²´ì¢Œí‘œë¥¼ ë°›ì•„ì™€ì„œ x, yì¢Œí‘œë¥¼ ì´ìš©í•´ì„œ
   í…Œì´ë¸” ë‚´ì—ì„œ ëª‡ë²ˆì§¸ ë¸”ë¡ì¸ì§€, ë°ì´í„°ë¡œ ì¹˜í™˜í•˜ê²Œ ëœë‹¤.

í˜„ì¬ ëˆŒëŸ¬ì§„ ë¸”ë¡ì´ ì²« ì‹œì‘? ì•„ë‹ˆë©´ ì¤‘ê°„? 1. ì‹œì‘ ë¸”ë¡ - ì§€ê¸ˆ ì„ íƒì´ ì‹œì‘ë˜ëŠ” ë¸”ë¡ - ë¼ì´ì–¸íƒ€ì…ì´ë©´
ê³„ì† ë¼ì´ì–¸ íƒ€ì… - ì‹œì‘ê°’ì€ ì™œ ì•Œì•„ì•¼í•˜ì§€? - ëŒì•„ê°€ê¸°ë„ í•´ì•¼í•¨. 2. í˜„ì¬ ë¸”ë¡ - moveí• ë•Œë§ˆë‹¤ ë³€í•¨
(cursorì™€ ê°™ì€)

```js
const down = e => {
  // downëœ ìƒíƒœë¥¼ í™œì„±
  // x, yë¡œë¶€í„° block ë°ì´í„°ë¥¼ ì–»ìŒ
  // ìœ„ì—ì„œ ì–»ì€ ë¸”ë¡ì„ ì‹œì‘ë¸”ë¡ ë° í˜„ì¬ ë¸”ë¡ìœ¼ë¡œ ì„¤ì •í•˜ê³  ì„ íƒëª©ë¡ì— í¬í•¨ì‹œí‚´.
};
```

1. downì˜ ìƒíƒœê°’

- downì´ ì•„ë‹ë•Œë§Œ down.

2. ì–´ë–¤ ë¸”ë¡ì´ ì„ íƒë˜ì–´ìˆëŠ”ì§€.
3. x,yê°’ì„ ë„£ìœ¼ë©´ ëª‡ë²ˆì§¸ì¸ì§€ ì•Œì•„ë‚¼ ìˆ˜ ìˆëŠ” í•¨ìˆ˜

```js
const column = 8, row = 8, blockSize = 80;
const data = [];
let table;
ğŸ‘‡ğŸ‘‡ğŸ‘‡
let startBlock, currBlock, isDown;
const selected = [], getBlock = (x, y) => {...}

const down = ({pageX: x, pageY: y}) => {
  if(isDown) return;
  const curr = getBlock(x,y);
  if(!curr) return;
  isDown = true;
  selected.length = 0;
  selected[0] = startBlock = currBlock = curr;
  render();
}
ğŸ‘†ğŸ‘†ğŸ‘†
```

getBlockì´ì™¸ì˜ ë°‘ì—ë‚˜ì˜¤ëŠ” ë¡œì§ì€ ì „ë¶€ ì¸ë©”ëª¨ë¦¬ ë¡œì§. ë„¤ì´í‹°ë¸Œ ë ˆì´ì–´ë¥¼ ë‹¤ë£¨ëŠ” ë°©ë²•ì€ ì¦‰ì‹œ ì¸ë©”ëª¨ë¦¬
ê°ì²´ë¡œ ë³€í™˜í•œë‹¤.

---

##### cf\_\_6. ë„¤ì´í‹°ë¸Œ ê°ì²´ë¥¼ ë‹¤ë£°ë•Œ ê°€ì¥ ì¤‘ìš”í•œ ìš”ë ¹

- **ë„¤ì´í‹°ë¸Œ ë ˆì´ì–´ë¥¼ ìµœëŒ€í•œ ì¤„ì´ëŠ” ê²ƒ.**
- ë„¤ì´í‹°ë¸Œì˜ ì •ë³´ ì¤‘ì— í•„ìš”í•œ í•µì‹¬ì •ë³´ë§Œ ì´ìš©í•´ì„œ ì¦‰ì‹œ ì¸ë©”ëª¨ë¦¬ ê°ì²´ë¡œ ë°”ê¿ˆ.
- ë„¤ì´í‹°ë¸Œì˜ ì½”ë“œê°€ ë§ì´ í¼ì ¸ìˆìœ¼ë©´ í¼ì ¸ìˆì„ìˆ˜ë¡ ë”ìš±ë” ë‹¤ë£¨ê¸° ì–´ë µê³  ë”ìš±ë” ì»¨ë²„íŒ…í•˜ê¸° ì–´ë µê²Œ ëœë‹¤.
- ë„¤ì´í‹°ë¸Œ ì½”ë“œì¤‘ì— í•„ìš”í•œ ë¶€ë¶„ë§Œ ì¶”ì¶œí•´ì„œ => ì¦‰ì‹œ ì¸ë©”ëª¨ë¦¬ ê°ì²´ë¡œ ë°”ê¾¸ê³ 
- ë‚˜ë¨¸ì§€ ë¡œì§ì€ ì¸ë©”ëª¨ë¦¬ì—ì„œ ìˆ˜ìš©í•˜ë„ë¡ í•¨.

> ì¢‹ì€ ê°œë°œì ë§í•˜ë©´ ì½”ë“œë¡œ ì˜®ê¸°ëŠ” ê²ƒì´ ë¦¬ì–¼íƒ€ì„ì´ ë ë•Œê¹Œì§€.. í›ˆë ¨í•˜ì. ì¢‹ì€ ê°œë°œìëŠ” ì œì–´ë¬¸ì„
> ì˜ì“°ê±°ë‚˜, ì½”ë“œë¥¼ í•œêµ­ì–´ë¡œ ë²ˆì—­í•˜ê±°ë‚˜ í•œêµ­ì–´ë¥¼ ì½”ë“œë¡œ ë²ˆì—­í•˜ëŠ” ëŠ¥ë ¥ì— ë‹¬ë ¤ìˆë‹¤. ìˆ™ë ¨ì„ ë§ì´ í•´ì„œ
> ì‹¤ì‹œê°„ìœ¼ë¡œ.

---

#### 5.cf ë„¤ì´í‹°ë¸Œ ì½”ë“œ => ì¸ë©”ëª¨ë¦¬ ê°ì²´ë¡œ ë³€í™˜

```ts
// ë„¤ì´í‹°ë¸Œ ê°ì²´ì˜ ê°’ì„ => ì¸ë©”ëª¨ë¦¬ ê°ì²´ë¡œ ë³€í™˜í•´ì£¼ëŠ” ë³€í™˜ê¸° !
// ë§ì´ ë‚˜ì˜´.
const getBlock = (x: number, y: number): Block => {
  const { top: T, left: L } = table.getBoundingClientRect();
  if (x < L || x > L + blockSize * row || y < T || y > T + blockSize * column) return null;
  // ë°”ë‘‘íŒ ë²”ìœ„ë¥¼ ë„˜ëŠ” ê²½ìš° ì œì™¸(ì™¼ìª½ë„˜ì–´, ì˜¤ë¥¸ìª½ë„˜ì–´, ìœ„ìª½ë„˜ì–´, ì•„ë˜ìª½ ë„˜ì–´)
  return data[parseInt(y - T) / blockSize][parseInt(x - L) / blockSize];
};
```

- `getBoundingClientRect` Element.getBoundingClientRect() ë©”ì„œë“œëŠ” ìš”ì†Œì˜ í¬ê¸°ì™€ ìš”ì†Œì˜
  viewportì—ì„œì˜ ìƒëŒ€ì ì¸ ìœ„ì¹˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
  ```bash
    DOMRect
    { x: 0,
      y: 0,
      width: 0,
      height: 0,
      top: 0,
      bottom: 0,
      left: 0,
      right: 0
    }
  ```

---

---


### 5.2 ì´ë²¤íŠ¸ > ë¸”ëŸ­ì„ ë–¼ëŠ” ìˆœê°„: up
ì½”ì–´ì•¡ì…˜ì´ ì—¬ê¸°ì„œ ë‹¤ ì¼ì–´ë‚œë‹¤.
1. downì„ í•´ì œ
2. ì„ íƒëª©ë¡ì´ 3ì´ìƒì´ë©´ ì‚­ì œ ì‹¤ì‹œ
3. 2ì´í•˜ë©´ ë¦¬ì…‹

```js
const up = e => {
  // downì„ í•´ì œ
  // ì„ íƒëª©ë¡ì´ 3ì´ìƒì´ë©´ ì‚­ì œ ì‹¤ì‹œ
  // 2ì´í•˜ë©´ ë¦¬ì…‹
};
```

#### 5.2.0 reset

ì„ íƒí•­ëª©ì´ 2ì´í•˜ë©´ ëª¨ë‘ ì´ˆê¸°í™”ì‹œí‚¨ë‹¤.

```js
const up = _ => (selected.length > 2 ? remove() : reset());

const reset = _ => {
  startBlock = currBlock = null;
  selected.length = 0;
  isDown = false;
  render();
};
```

---

##### cf\_\_7. ì‰¬ìš´ê²ƒë¶€í„° ì§œì!

ì‰¬ìš´ ê²ƒì€ ì˜ì¡´ì„±ì´ ì—†ë‹¤. ê³ ì¹  ì¼ì´ ì ë‹¤. ë³µì¡í•œ ê²ƒë¶€í„° ì§œë©´ ì˜ì¡´ì„±ì´ ë§ì€ ê²ƒë¶€í„° ì§œê²Œ ë˜ê³ , ë‚˜ì¤‘ì—
ê¹¨ë‹¬ì€ê²Œ ë§ì„ìˆ˜ë¡ ë” ë§ì´ ê³ ì¹˜ê²Œ ëœë‹¤.

---

1. ì„ íƒëœ ë¸”ë¡ë“¤ì„ ì§€ì›Œì£¼ê³  => remove
2. ë–¨ì–´ëœ¨ë¦° ë‹¤ìŒì— => drop
3. ìƒˆë¡œ ìƒì„±í•˜ê³  => readyToFill
4. ë‹¤ì‹œ ë‚´ë ¤ì™€ì£¼ë©´ì„œ, í•©ì³ì¤˜ì•¼í•¨. => fill


#### 5.2.1 remove ğŸ˜«ğŸ˜«

```js
const remove = () => {
  /* ë°ì´í„° ë‚´ë¶€ì˜ rowë¥¼ ëŒë©´ì„œ
    í•´ë‹¹ rowì— ì„ íƒëœ ìš”ì†Œê°€ ì¡´ì¬í•˜ë©´ nullë¡œ ë§Œë“œëŠ” í•¨ìˆ˜.
  */
  data.forEach(r => {
    selected.forEach(v => {
      let i;
      if ((i = r.indexOf(v)) !== -1) r[i] = null;
    });
  });
  render();
  setTimeout(drop, 300);
};
```

> forEachëŠ” forë¬¸ë³´ë‹¤ ëŒ€í™”ê°€ë¨.

columnì„ ëŒë©´ì„œ rowë¥¼ ê³„ì‚°í•´ì„œ ë–¨ì–´ëœ¨ë¦¬ëŠ” ì¼ì„ í•œë‹¤. í•œí„´ì—ëŠ” í•œì¹¸ì”© ë–¨ì–´ì§„ë‹¤. ì¤‘ë ¥ì— ì˜í•´ ë–¨ì–´ì§€ëŠ”
ë°©í–¥ì€ columnê¸°ì¤€ì´ê¸°ë•Œë¬¸ì— columnì„ ë¨¼ì € loopëŒë¦°ë‹¤. rowëŠ” ë§¨ ì•„ë«ì¤„ë¶€í„° ë–¨ì–´ì§€ëŠ” ì‘ì—…ì„
í•´ì•¼í•˜ë¯€ë¡œ.. (ì „ì²´row -1) ë¶€í„° ì‹œì‘

- isNext: ìœ—ì¤„ì—ë„ blockì´ ìˆëŠ” ìƒí™©ì´ë¼ ë‹¤ìŒ rowë„ ê²€ì‚¬í•´ì•¼í•˜ëŠ”ì§€.
- isEmpty: ë–¨ì–´ì§ˆ ë¸”ëŸ­ì´ í•˜ë‚˜ì˜ column rowë“¤ì— ìˆëŠ”ì§€ ì—†ëŠ”ì§€.

```js
const drop = _ => {
  let isNext = false; // dropì„ ë” í•´ì•¼í•˜ëŠ”ì§€ ë§ì•„ì•¼í•˜ëŠ”ì§€.
  for (let j = 0; j < column; j++) {
    for (let i = row - 1; i > -1; i--) {
      if (!data[i][j] && i) {
        // í•´ë‹¹ êµ¬ë©ì— ë¸”ëŸ­ì´ ì—†ê³ , rowì˜ ì¸ë±ìŠ¤ê°€ 0ì´ ì•„ë‹Œ(ê¼­ëŒ€ê¸°ê°€ ì•„ë‹Œ)
        let k = i, // í•´ë‹¹ ì¤„ì˜ indexë¥¼ ë³µì‚¬í•œë‹¤.
          isEmpty = true; // data[i][j] ìœ„ì— ë–¨ì–´ì§ˆ ë¸”ëŸ­ì´ ë¹„ì—ˆëŠ”ì§€ ì•„ë‹Œì§€.
        while (k--)
          // indexë¥¼ í•˜ë‚˜ì”© í™•ì¸í•˜ë©´ì„œ
          if (data[k][j]) {
            // ìœ„ì— ë¸”ëŸ­ì´ ìˆìœ¼ë©´
            isEmpty = false; // ìœ„ì— ë–¨ì–´ì§ˆ ë¸”ëŸ­ì´ í•˜ë‚˜ë¼ë„ ìˆë‹¤ëŠ” ëœ»
            break; // ë°˜ë³µë¶„ì„ ëë‚¸ë‹¤.
          }
        if (isEmpty) break; // ìœ„ì— ë–¨ì–´ì§ˆ ë¸”ëŸ­ì´ í•˜ë‚˜ë„ ì—†ìœ¼ë©´ row loop ì¢…ë£Œ ë‹¤ìŒ column loop ì‹œì‘

        // ìœ„ì— ë¸”ëŸ­ì´ í•˜ë‚˜ë¼ë„ ìˆëŠ” ìƒí™©ì´ê³ ,
        // ë‹¤ìŒ rowë„ ê²€ìƒˆí–ì•„í•¨ì„ flag
        isNext = true;

        // ë–¨ì–´ëœ¨ë¦¬ê¸°.
        while (i--) {
          // í•´ë‹¹ ì¤„ ìœ„ì—
          data[i + 1][j] = data[i][j]; // í˜„ì¬ ê²€ì‚¬í•œ ë¸”ëŸ­ì— ìœ„ì˜ ë¸”ëŸ­ì„ ë„£ì–´ì£¼ê³ ,
          data[i][j] = null; // ìœ„ì˜ ë¸”ëŸ­ì€ nullë¡œ ì´ˆê¸°í™”
        }
        break; // row loopë¥¼ ì¢…ë£Œ ë‹¤ìŒ column loop ì‹œì‘
      }
    }
  }
  render();
  isNext ? setTmeout(drop, 300) : readyToFill();
};
```

> ã…‹ã…‹ã…‹ ã… ã…  ëŒ€ëŒœëƒëŒœ.. ë¨¸ë¦¬ê°€ ì¢‹ì•„ì§€ëŠ”ìˆ˜ë°–ì— ì—†ë‹¤. ì˜ì§œê³ , ì‰½ê²Œ ì§¤ë•Œê¹Œì§€ ë¨¸ë¦¬ë¡œ í›ˆë ¨í•˜ëŠ” ìˆ˜ë°–ì—
> ì—†ë‹¤. ì•Œê³ ë¦¬ì¦˜, ì½”ë”©ì¸í„°ë·°, ìë£Œêµ¬ì¡°, íŠ¸ë¦¬êµ¬ì¡° ë³´ë‹¤ ë„ë©”ì¸ í•´ì„ ëŠ¥ë ¥ì„ í‚¤ìš°ì. ì–´ë– í•œ ë„ë©”ì¸ì—
> ëŒ€í•´ì„œ ì•Œê³ ë¦¬ì¦˜ì„ ì§œëŠ” ëŠ¥ë ¥ì€ í›ˆë ¨ë°–ì— ì—†ë‹¤. ë³µì¡í•œ ì¼ì´ ì¼ì–´ë‚˜ëŠ” ê²ƒì„ ëˆˆìœ¼ë¡œ ê´€ì°°í•´ì„œ ì–´ë–¤ ì¼ì¸ì§€
> íŒŒì•…í•œ ë‹¤ìŒì— ì½”ë“œë¡œ ì°¨ê·¼ì°¨ê·¼ í‘¸ëŠ”ê±´ í›ˆë ¨ë°–ì— ì—†ë‹¤. ì´ê±° ì•ˆë˜ë©´ ì•„í‚¤í…ì²˜ê³  ë””ìì¸íŒ¨í„´ì´ê³ 
> í•„ìš”ì—†ë‹¤..

---

ì±„ìš¸ì¤€ë¹„ë¥¼ í•˜ëŠ” ê²ƒì€ ë°–ì—ë¶€í„° ì±„ì›Œì•¼í•˜ëŠ” ì• ë“¤ì´ ì˜ˆì˜ê²Œ ë‚´ë ¤ì˜¤ê²Œ í•˜ê¸° ìœ„í•´ì„œ.

1. ì§€ì›Œì§„ ëª¨ì–‘ ê·¸ëŒ€ë¡œì˜ í˜•íƒœê°€ ìœ„ì— í˜•ì„±ë˜ê³  => readyToFill
2. í•´ë‹¹ í˜•íƒœê°€ ë–¨ì–´ì§€ëŠ” ìƒí™© => fill

```js
const fills = [];
// fill ë°°ì—´ ì´ˆê¸°í™”
// columnì€ ë˜‘ê°™ê³ , rowë§Œ ê³„ì‚°í•´ì„œ ìƒì„±í•˜ë©´ ë¨.
// ì‹¤ì œ fillsì˜ ê¸¸ì´ì™€ ì±„ì›Œì§„ ì¹´ìš´íŒ…ì´ ê°™ê²Œë˜ë©´ ë‹¤ ì±„ì›Œì¡Œë‹¤ê³  ë³¼ ì˜ˆì •
let fillCnt = 0;

const readyToFill = _ => {
  fills.length = 0;

  // dataë¥¼ ëŒë©´ì„œ êµ¬ë©ë‚œ ë¶€ë¶„ì„ ì°¾ëŠ”ë‹¤.
  data.some(row => {
    if (row.indexOf(null) === -1) return ture; // êµ¬ë©ì—†ëŠ” rowë©´ ëëƒ„.

    const r = [...row].fill(null); // ìƒˆë¡œìš´ rowë¥¼ ë§Œë“¤ì–´ì„œ ìš°ì„  nullë¡œ ì±„ì›€
    fills.push(r);
    row.forEach((v, i) => !v && (r[i] = Block.GET()));
    // vê°€ ì—†ìœ¼ë©´ í•´ë‹¹ êµ¬ë©ì— blockìœ¼ë¡œ ì±„ì›€
  });
  fillCnt = 0; // ?
  setTimeout(fill, 300);
};

const fill = _ => {
  if (fillCnt > fills.length) {
    // fillCntê°€ ì¦ê°€í•˜ë‹¤ê°€ fillsì˜ lengthì™€ ì¼ì¹˜í•˜ë©´ ê·¸ë§Œë‘˜ ë•Œ
    isDown = false;
    return;
  }
  for (let i = 0; i < fillCnt; i++) {
    // ì±„ì›Œì•¼í•˜ëŠ” fill ë°°ì—´ì˜ rowì—ì„œ í•´ë‹¹ ìš”ì†Œê°€ nullì´ ì•„ë‹ˆë¼ ì±„ì›Œì ¸ìˆìœ¼ë©´(v),
    // dataì˜ í•´ë‹¹ ìš”ì†Œì— vë¥¼ ë„£ëŠ”ë‹¤.

    // fillsì— ìˆëŠ” ë§ˆì§€ë§‰ì¤„ë¶€í„° ìœ—ì¤„ì„ ì±„ì›Œê°€ë©´ ëœë‹¤..
    fills[fills.length - i - 1].forEach((v, j) => {
      if (v) data[fillCnt - i - 1][j] = v;
    });
  }
  fillCnt++;
  render();
  setTimeout(fill, 300);
};
```

---

---


### 5.3 ì´ë²¤íŠ¸ > ë¸”ëŸ­ì„ downí•˜ë©´ì„œ ì›€ì§ì´ëŠ” ìƒíƒœ: move
ëˆ„ë¥¸ìƒíƒœì—ì„œ ë‹¤ìŒ(í˜¹ì€ ì´ì „) ë¸”ëŸ­ìœ¼ë¡œ ì›€ì§ì´ëŠ” ìƒíƒœ

```js
const move = e => {
  // downì´ ì•„ë‹ˆë¼ë©´ ì´íƒˆ
  // x,y ìœ„ì¹˜ì˜ ë¸”ë¡ì„ ì–»ìŒ
  // ìœ„ì—ì„œ ì–»ì€ ë¸”ë¡ì´ ì´ì „ ë¸”ë¡ì˜ íƒ€ì…ì´ ê°™ê³  ì¸ì ‘ë˜ì–´ìˆëŠ”ì§€ ê²€ì‚¬
  // ìœ„ì—ì„œ ì–»ì€ ë¸”ë¡ì´ ì„ íƒëª©ë¡ì— ì—†ìœ¼ë©´ ì¶”ê°€
  // ìœ„ì—ì„œ ì–»ì€ ë¸”ë¡ì´ ì„ íƒëª©ë¡ì— ìˆë‹¤ë©´ ì „ì „ ë¸”ë¡ì¼ ê²½ìš° í•˜ë‚˜ ì‚­ì œ
};
```

```js
const move = ({ pageX: x, pageY: y }) => {
  if (!isDown) return;
  const curr = getBlock(x, y);
  if (!crr || curr.type !== startBlock.type || !isNext(curr)) return;
  if (selected.indexOf(curr) == -1) selected.push(curr);
  else if (selected[selected.length - 1] == curr) selected.pop();
  currBlock = curr;
  render();
};
```

```js
// ë°›ì•„ì˜¤ëŠ” curr ë¸”ëŸ­ê³¼ cacheí•´ë†“ì€ curr ë¸”ëŸ­ì„ ë¹„êµí•˜ì—¬ ì¸ì ‘í•´ìˆëŠ”ì§€ ê²€ì‚¬.
// ë‚˜ì™€ ìœ„ì¹˜ê°€ í•œê°œ ì°¨ì´ ë‚œë‹¤ëŠ” ê²ƒ. xë¡œ í•˜ë‚˜ ì°¨ì´ í˜¹ì€ yë¡œ í•˜ë‚˜ ì°¨ì´
const isNext = curr => {
  let r0,
    c0,
    r1,
    c1,
    cnt = 0;

  /* dataì—ì„œ ë“¤ì–´ì˜¨ 
    currì˜ xì¸ë±ìŠ¤, yì¸ë±ìŠ¤ì™€ 
    currBlockì˜ xì¸ë±ìŠ¤ì™€ yì¸ë±ìŠ¤ë¥¼ êµ¬í•˜ëŠ” ë°©ë²•. 
  */
  data.some((row, i) => {
    let j;
    if ((j = row.indexOf(currBlock)) !== -1) ((r0 = i), (c0 = j), cnt++);
    if ((j = row.indexOf(curr)) !== -1) ((r1 = i), (c1 = j), cnt++);
    return cnt === 2;
  });

  return curr !== currBlock && (Math.abs(r0 - r1) === 1 || Math.abs(c0 - c1) === 1);
};
```

ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë°°ì—´ì˜ ê³ ì°¨í•¨ìˆ˜ë¡œ ì—¬ëŸ¬ ì œì–´ë¬¸ì„ ì œê±°í•  ìˆ˜ ìˆë‹¤.

## ìµœì¢… ì½”ë“œ ë° ì •ë¦¬

í”„ë¡œì‹œì € í•¨ìˆ˜: ë°˜í™˜ê°’ì´ ì—†ëŠ” í•¨ìˆ˜ sideEffectê°€ ì—„ì²­ ë§ë‹¤. í˜„ì¬ ë¡œì§ë“¤ì€ ëª¨ë‘ í”„ë¡œì‹œì € í•¨ìˆ˜. ì•ìœ¼ë¡œ
ê°ì²´ì§€í–¥ìœ¼ë¡œ ë¦¬íŒ©í† ë§ ì˜ˆì •.

<details>
<summary>ìµœì¢…ì½”ë“œ (TS ver.)</summary>

```ts
// Gameì—ì„œ ì‚¬ìš©í•œ interface
interface IGame {
  // ê²Œì„íŒ ì •ë³´
  column: number;
  row: number;
  blockSize: number;
  data: (Block | null)[][];

  // ë„¤ì´í‹°ë¸Œ ê°ì²´ ì •ë³´
  table: HTMLElement;

  // ìƒíƒœ ì •ë³´
  startBlock: Block;
  currBlock: Block;
  isDown: boolean;
  selected: Block[];
  isNext: (curr: Block) => boolean;
  getBlock: (x: number, y: number) => Block;

  // ì´ë²¤íŠ¸ ê´€ë ¨
  down: ({ pageX: x, pageY: y }: { pageX: number; pageY: number }) => void;
  move: ({ pageX: x, pageY: y }: { pageX: number; pageY: number }) => void;
  up: () => void;
  reset: () => void;
  remove: () => void;
  drop: () => void;
  fills: (Block | null)[][];
  fillCnt: number;
  readyToFill: () => void;
  fill: () => void;

  // util
  el: (tag: HTMLElementTagNameMap) => HTMLElement;

  render: () => void;
}
```

```ts
// ë„ì €íˆ ë¨¸ë¦¬ê°€ ë”°ë¼ê°€ê¸° í˜ë“¤ì–´ì„œ TSë¡œ ìš°ì„  ë³€í™˜..
const Game = (() => {
  class Block {
    static GET(type = Math.random() * 5) {
      return new Block(type);
    }
    _type: number;
    constructor(type) {
      this._type = type;
    }
    get image() {
      return `url('img/block${this._type}.png')`;
    }
    get type() {
      return this._type;
    }
  }

  const column = 8,
    row = 8,
    blockSize = 80;
  const data: (Block | null)[][] = [];

  let table: HTMLElement;
  let startBlock: Block, currBlock: Block, isDown: boolean;
  const selected: Block[] = [];

  const getBlock = (x: number, y: number): Block => {
    const { top: T, left: L } = table.getBoundingClientRect();
    if (x < L || x > L + blockSize * row || y < T || y > T + blockSize * column) return null;
    return data[(y - T) / blockSize][(x - L) / blockSize];
  };

  const isNext = (curr: Block): boolean => {
    let r0: number,
      c0: number,
      r1: number,
      c1: number,
      cnt = 0;
    data.some((row: (Block | null)[], i: number) => {
      let j: number;
      if ((j = row.indexOf(currBlock)) != -1) ((r0 = i), (c0 = j), cnt++);
      if ((j = row.indexOf(curr)) != -1) ((r1 = i), (c1 = j), cnt++);
      return cnt == 2;
    });
    return (curr != currBlock && Math.abs(r0 - r1) == 1) || Math.abs(c0 - c1) == 1;
  };

  const reset = () => {
    startBlock = currBlock = null;
    selected.length = 0;
    isDown = false;
    render();
  };

  const remove = () => {
    data.forEach((r: (Block | null)[]) => {
      //ë°ì´í„°ì‚­ì œ
      selected.forEach((v: Block) => {
        let i: number;
        if ((i = r.indexOf(v)) != -1) r[i] = null;
      });
    });
    render();
    setTimeout(drop, 300);
  };

  const drop = () => {
    let isNext = false;
    for (let j = 0; j < column; j++) {
      for (let i = row - 1; i > -1; i--) {
        if (!data[i][j] && i) {
          let k = i,
            isEmpty = true;
          while (k--)
            if (data[k][j]) {
              isEmpty = false;
              break;
            }
          if (isEmpty) break;
          isNext = true;
          while (i--) {
            data[i + 1][j] = data[i][j];
            data[i][j] = null;
          }
          break;
        }
      }
    }
    render();
    isNext ? setTimeout(drop, 300) : readyToFill();
  };

  const fills: (Block | null)[][] = [];
  let fillCnt = 0;

  const readyToFill = () => {
    fills.length = 0;
    data.some((row: (Block | null)[]) => {
      if (row.indexOf(null) == -1) return true;
      const r: (Block | null)[] = [...row].fill(null);
      fills.push(r);
      row.forEach((v: Block | null, i) => !v && (r[i] = Block.GET()));
    });
    fillCnt = 0;
    setTimeout(fill, 300);
  };

  const fill = () => {
    if (fillCnt > fills.length) {
      isDown = false;
      return;
    }
    for (let i = 0; i < fillCnt; i++) {
      fills[fills.length - i - 1].forEach((v, j) => {
        if (v) data[fillCnt - i - 1][j] = v;
      });
    }
    fillCnt++;
    render();
    setTimeout(fill, 300);
  };

  const down = ({ pageX: x, pageY: y }: { pageX: number; pageY: number }) => {
    if (isDown) return;
    const curr = getBlock(x, y);
    if (!curr) return;
    isDown = true;
    selected.length = 0;
    selected[0] = startBlock = currBlock = curr;
    render();
  };

  const move = ({ pageX: x, pageY: y }) => {
    if (!isDown) return;
    const curr = getBlock(x, y);
    if (!curr || curr.type != startBlock.type || !isNext(curr)) return;
    if (selected.indexOf(curr) == -1) selected.push(curr);
    else if (selected[selected.length - 2] == curr) selected.pop();
    currBlock = curr;
    render();
  };

  const up = () => (selected.length > 2 ? remove() : reset());

  const el = (tag: keyof HTMLElementTagNameMap) => document.createElement(tag);
  const render = () => {
    table.innerHTML = '';
    data.forEach(row =>
      table.appendChild(
        row.reduce((tr, block) => {
          tr.appendChild(el('td')).style.cssText = `
        ${block ? `background:${block.image};` : ''}
        width:${blockSize}px;
        height:${blockSize}px;
        cursor:pointer`;
          return tr;
        }, el('tr'))
      )
    );
  };
  return (tid: string) => {
    table = document.querySelector(tid);
    for (let i = 0; i < row; i++) {
      const r = [];
      data.push(r);
      for (let j = 0; j < column; j++) r[j] = Block.GET();
    }
    table.addEventListener('mousedown', down);
    table.addEventListener('mouseup', up);
    table.addEventListener('mouseleave', up);
    table.addEventListener('mousemove', move);
    render();
  };
})();
Game('#stage');
```

</details>
